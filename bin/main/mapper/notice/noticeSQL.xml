<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="droll.notice.mapper.NoticeMapper">

<select id="selectList" parameterType="hashmap" resultType="hashmap"><![CDATA[
SELECT NOTICE_ID
	 , NOTICE_TITLE
     , RETRIEVE_CNT
     , CRE_USER
     , CRE_DATETIME
  FROM TB_NOTICE
 WHERE DEL_YN = 'N'
 ORDER BY CRE_DATETIME DESC
]]></select>

<insert id="insertBoard" parameterType="hashmap"><![CDATA[
INSERT INTO TB_BOARD (
    NOTICE_ID
  , CRE_USER
  , CRE_DATETIME
  , NOTICE_TITLE
  , NOTICE_CONTENT
  , RETRIEVE_CNT
  , DEL_YN
)VALUES(
	  #{NOTICE_ID}
	, 'Droll'
	, now()
	, #{NOTICE_TITLE}
	, #{NOTICE_CONTENT}
	, 0
	, 'N'
]]> </insert>

<update id="updateHitCnt" parameterType="hashmap"> <![CDATA[ 
UPDATE TB_BOARD SET 
	HIT_CNT = NVL(HIT_CNT, 0) + 1
WHERE IDX = #{IDX}	
]]> </update> 

<select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap"> <![CDATA[ 
SELECT IDX
	 , HIT_CNT
	 , CREA_ID
	 , CREA_DTM
	 , TITLE
	 , CONTENTS 
  FROM TB_BOARD 
 WHERE IDX = #{IDX}	
]]> </select>

<update id="updateBoard" parameterType="hashmap"> <![CDATA[ 
UPDATE TB_BOARD SET 
	TITLE = #{TITLE}
  , CONTENTS = #{CONTENTS} 
WHERE IDX = #{IDX}	
]]> </update>

<update id="deleteBoard" parameterType="hashmap"> <![CDATA[ 
UPDATE TB_BOARD SET 
	DEL_GB = 'Y' 
WHERE IDX = #{IDX} 
]]> </update>

<insert id="insertFile" parameterType="hashmap"><![CDATA[
INSERT INTO TB_FILE(
    IDX
  , BOARD_IDX
  , ORIGINAL_FILE_NAME
  , STORED_FILE_NAME
  , FILE_SIZE
  , CREA_ID
  , CREA_DTM
)VALUES(
    (SELECT IFNULL(MAX(IDX),0) + 1 FROM TB_FILE b)
  , #{BOARD_IDX}
  , #{ORIGINAL_FILE_NAME}
  , #{STORED_FILE_NAME}
  , #{FILE_SIZE}
  , 'Admin'
  , now()
)
]]></insert>

<select id="selectFileList" parameterType="hashmap" resultType="hashmap"><![CDATA[
SELECT IDX
     , ORIGINAL_FILE_NAME
     , ROUND(FILE_SIZE/1024,1) AS FILE_SIZE
  FROM TB_FILE
 WHERE BOARD_IDX = #{IDX}
   AND DEL_GB = 'N'
]]></select>

<update id="deleteFileList" parameterType="hashmap"><![CDATA[ 
UPDATE TB_FILE SET 
	DEL_GB = 'Y' 
 WHERE BOARD_IDX = #{IDX}	
]]></update> 

<update id="updateFile" parameterType="hashmap"><![CDATA[ 
UPDATE TB_FILE SET 
	DEL_GB = 'N'
 WHERE IDX = #{FILE_IDX}	
]]></update>

</mapper>